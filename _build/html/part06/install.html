

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Install &mdash; Metatron Discovery Install Docs 0.4.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/layout.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/layout.css" type="text/css" />
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" />
    <link rel="prev" title="Metatron Integrator" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo2.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2019-12-05
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../part00/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part01/index.html">기본 환경</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part02/index.html">Hadoop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part03/index.html">Metatron Engine (Druid)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part04/index.html">Metatron Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part05/index.html">Metatron Anomaly</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Metatron Integrator</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Install</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">1.&nbsp;Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-oozie">2. Install oozie</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oozie-conf-proxy-user">2-1. oozie conf 내 proxy user 추가</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oozie-conf-jpa">2-2. oozie conf 내 JPA 설정</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oozie-server-timezone">2-3. oozie server timezone 설정</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oozie-conf-jms">2-4. oozie conf 내 JMS 설정</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#install-integrator">3. Install Integrator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oozie-listen-port-open">3-1. oozie listen port open</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hadoop-cluster-webhdfs-port-open">3-2. hadoop cluster 내 webhdfs port open</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-yaml">3-3. application.yaml 설정</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-application-directory-in-hdfs">3-3. Make application directory in HDFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integrator-library-upload-to-hdfs">3-4. integrator library upload to HDFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-run-script-integrator-sh">3-5. application run script(integrator.sh) 확인</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-start">3-6. application start</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Metatron Discovery Install Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Metatron Integrator</a> &raquo;</li>
        
      <li>Install</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/part06/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="install">
<h1>Install<a class="headerlink" href="#install" title="제목 주소">¶</a></h1>
<p>&nbsp;metatron integrator 는 hadoop 내에 데이터를 수집,처리할 수 있는 tool 로써 oozie 엔진을 기반으로 동작한다.</p>
<p>&nbsp;oozie 는 hadoop component(MR, Hive, Spark, Exec, ...) 를 사용하기 때문에 hadoop component 들의 설치가 우선적으로 문제없이 동작하는 환경을 구성하여야 한다. 이를 바탕으로 oozie 가 설치되고 integrator 가 설치되어야 한다.</p>
<div class="section" id="requirements">
<h2>1.&nbsp;Requirements<a class="headerlink" href="#requirements" title="제목 주소">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>CentOS 6.x 이상 권장</li>
<li>Java 1.8 이상</li>
<li>Hadoop cluster 2.6.x 이상 권장</li>
<li>mysql (mariadb) 5.5 이상 권장</li>
<li>oozie 4.3.0 이상</li>
<li>activemq 5.15.6 이상</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="install-oozie">
<h2>2. Install oozie<a class="headerlink" href="#install-oozie" title="제목 주소">¶</a></h2>
<p>&nbsp;oozie 는 4.3.0 버전 이상을 설치하여야 하며, 설치와 실행에 대한 사항은 오피셜 사이트(<a class="reference external" href="http://oozie.apache.org/">http://oozie.apache.org/</a>)를 참조.</p>
<p>&nbsp;oozie server configuration 에는 timezone 과 proxy user 설정등이 추가되어 있어야 한다.</p>
<div class="section" id="oozie-conf-proxy-user">
<h3>2-1. oozie conf 내 proxy user 추가<a class="headerlink" href="#oozie-conf-proxy-user" title="제목 주소">¶</a></h3>
<p>아래와 같이 integrator application 이 실행되는 계정(metatron)에 대해서 proxy user 를 추가한다.</p>
<blockquote>
<div><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.ProxyUserService.proxyuser.metatron.hosts<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.ProxyUserService.proxyuser.metatron.groups<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>
<div class="section" id="oozie-conf-jpa">
<h3>2-2. oozie conf 내 JPA 설정<a class="headerlink" href="#oozie-conf-jpa" title="제목 주소">¶</a></h3>
<p>oozie meta data 가 저장되는 DBMS 에 대한 설정을 정의한다.</p>
<blockquote>
<div><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.JPAService.jdbc.driver<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.JPAService.jdbc.url<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>jdbc:mysql://{DBMS Server IP}:{DBMS Server Port}/oozie<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.JPAService.jdbc.username<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>oozie_user<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>

 <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.service.JPAService.jdbc.password<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>oozie_userpassword<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>
<div class="section" id="oozie-server-timezone">
<h3>2-3. oozie server timezone 설정<a class="headerlink" href="#oozie-server-timezone" title="제목 주소">¶</a></h3>
<p>&nbsp;서버가 동작하는 지역 timezone 에 맞게 timezone 설정도 추가 되어야 한다.</p>
<blockquote>
<div><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.processing.timezone<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>GMT+0900<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>
<div class="section" id="oozie-conf-jms">
<h3>2-4. oozie conf 내 JMS 설정<a class="headerlink" href="#oozie-conf-jms" title="제목 주소">¶</a></h3>
<p>job 의 시작과 종료등 이벤트를 integrator 가 수신할 수 있도록 JMS 설정을 추가하여야 한다. oozie external library 중에 JMS 관련한 class 를 oozie.service.ext 에 등록하여야 하고 oozie.jms.producer.connection.properties 에는 JMS publish 할 수 있도록 설정을 추가하여야 한다.</p>
<p>설정 중에&nbsp;{activemq server IP} 는 activemq 가 설치되어 있는 서버 IP 로 대체되어야 한다.</p>
<blockquote>
<div><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.services.ext<span class="nt">&lt;/name&gt;</span>
         <span class="nt">&lt;value&gt;</span>
          org.apache.oozie.service.JMSAccessorService,
          org.apache.oozie.service.JMSTopicService,
          org.apache.oozie.service.EventHandlerService,
          org.apache.oozie.sla.service.SLAService
         <span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>oozie.jms.producer.connection.properties<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;value&gt;</span>java.naming.factory.initial#org.apache.activemq.jndi.ActiveMQInitialContextFactory;java.naming.provider.url#tcp://{activemq server IP}:61616;connectionFactoryNames#ConnectionFactory<span class="nt">&lt;/value&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>2-5. oozie port open
oozie와 integrator 는 rest API 를 통해서 통신하기 때문에 integrator → oozie direction 방향으로 oozie listen port(11000)에 대해 방화벽 오픈이 필요하다.</p>
</div>
</div>
<div class="section" id="install-integrator">
<h2>3. Install Integrator<a class="headerlink" href="#install-integrator" title="제목 주소">¶</a></h2>
<p>Integrator application 의 설치 경로는 기본적으로 /home/metatron/servers/metatron-integrator 를 사용하며, 변경이 필요한 경우 integrator.sh 파일내에 경로를 수정하여야 한다.</p>
<div class="section" id="oozie-listen-port-open">
<h3>3-1. oozie listen port open<a class="headerlink" href="#oozie-listen-port-open" title="제목 주소">¶</a></h3>
<p>oozie와 integrator 는 rest API 를 통해서 통신하기 때문에 integrator → oozie direction 방향으로 oozie listen port(11000)에 대해 방화벽 오픈이 필요하다.</p>
</div>
<div class="section" id="hadoop-cluster-webhdfs-port-open">
<h3>3-2. hadoop cluster 내 webhdfs port open<a class="headerlink" href="#hadoop-cluster-webhdfs-port-open" title="제목 주소">¶</a></h3>
<p>integrator 는 oozie xml 파일 혹은 hql, library 파일등을 업로드하기 위해서&nbsp; web hdfs 포트가 열려있어야 한다. 기본 포트인 50070 포트에 대해 integrator 가 접근할 수 있도록 방화벽 설정이 필요하다.</p>
</div>
<div class="section" id="application-yaml">
<h3>3-3. application.yaml 설정<a class="headerlink" href="#application-yaml" title="제목 주소">¶</a></h3>
<p>integrator 의 설정은 yaml 파일로 정의한다. yaml 파일은 section 으로 구성되어 있으며 각 section 의 역할은 아래와 같다.</p>
<p>section name    설명      비고
spring.datasource       integrator meta 정보를 저장하는 DB 서버 정보를 입력한다.
spring.jpa      integrator meta 정보를 저장할 DB 의 정보를 입력한다.
spring.mail     Job noti, SLA noti 를 받을 mail 서버 정보를 입력한다.
spring.activemq oozie 서버와 JMS 연동을 위한 activemq 서버 정보를 입력한다.
spring.hadoop   hadoop cluster 정보를 입력한다.
spring.oozie    oozie 서버 정보를 입력한다.
spring.hive     hive server 정보를 입력한다.
spring.druid    druid task 를 위한 discovery 설정 정보를 입력한다.
spring.polaris  druid task 를 위한 discovery 설정 정보를 입력한다.
notification.slack      Job noti, SLA noti 를 받을 slack 설정 정보를 입력한다.
notification.sms        Job noti, SLA noti 를 SMS 로 발송할 수 있도록 sms 서버 정보를 입력한다.
server.port     integrator 서버 listen port 를 설정한다.
zuul.route      metatron discovery 인증과 관련된 설정으로 discovery 서버 정보를 입력한다.
위와 같은 section 별로 설정된 yaml 파일의 sample 이다.</p>
<blockquote>
<div><div class="highlight-jproperties"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="na"> spring</span><span class="o">:</span>
<span class="na">     profiles</span><span class="o">:</span> <span class="s">prod</span>
<span class="na">     devtools</span><span class="o">:</span>
<span class="na">         restart</span><span class="o">:</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">         livereload</span><span class="o">:</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">     datasource</span><span class="o">:</span>                         <span class="s"># integrator metadata DBMS 서버 정보</span>
<span class="na">         type</span><span class="o">:</span> <span class="s">com.zaxxer.hikari.HikariDataSource</span>
<span class="na">         url</span><span class="o">:</span> <span class="s">jdbc:mysql://{dbserver IP}:{dbserver port}/integrator?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false           # db server 정보에 맞춰서 수정</span>
<span class="na">         username</span><span class="o">:</span> <span class="s">integrator                                                                                                     # db server 정보에 맞춰서 수정</span>
<span class="na">         password</span><span class="o">:</span> <span class="s">xxxxxxxxxx                                                                                                     # db server 정보에 맞춰서 수정</span>
<span class="na">         hikari</span><span class="o">:</span>
<span class="na">             data-source-properties</span><span class="o">:</span>
<span class="na">                 cachePrepStmts</span><span class="o">:</span> <span class="s">true</span>
<span class="na">                 prepStmtCacheSize</span><span class="o">:</span> <span class="s">250</span>
<span class="na">                 prepStmtCacheSqlLimit</span><span class="o">:</span> <span class="s">2048</span>
<span class="na">                 useServerPrepStmts</span><span class="o">:</span> <span class="s">true</span>
<span class="na">     jpa</span><span class="o">:</span>
<span class="na">         database-platform</span><span class="o">:</span> <span class="s">org.hibernate.dialect.MySQL5InnoDBDialect</span>
<span class="na">         database</span><span class="o">:</span> <span class="s">MYSQL</span>
<span class="na">         show-sql</span><span class="o">:</span> <span class="s">false</span>
<span class="na">         hibernate</span><span class="o">:</span>
<span class="na">           naming-strategy</span><span class="o">:</span> <span class="s">org.hibernate.cfg.EJB3NamingStrategy</span>
<span class="na">           naming</span><span class="o">:</span>
<span class="na">             physical-strategy</span><span class="o">:</span> <span class="s">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span>
<span class="na">         properties</span><span class="o">:</span>
<span class="na">             hibernate.id.new_generator_mappings</span><span class="o">:</span> <span class="s">true</span>
<span class="na">             hibernate.cache.use_second_level_cache</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             hibernate.cache.use_query_cache</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             hibernate.generate_statistics</span><span class="o">:</span> <span class="s">false</span>
<span class="na">     mail</span><span class="o">:</span>                               <span class="s"># Job event , SLA event 발생시 메일 발송을 위한 SMTP 서버 정보</span>
<span class="na">         host</span><span class="o">:</span> <span class="s">localhost</span>
<span class="na">         port</span><span class="o">:</span> <span class="s">25</span>
<span class="na">         username</span><span class="o">:</span>
<span class="na">         password</span><span class="o">:</span>
<span class="na">         sendAsMail</span><span class="o">:</span> <span class="s">&quot;Oozie Notification &lt;no_reply@sk.com&gt;&quot;</span>
<span class="na">     thymeleaf</span><span class="o">:</span>
<span class="na">         cache</span><span class="o">:</span> <span class="s">true</span>
<span class="na">     http</span><span class="o">:</span>                               <span class="s"># web upload file temporary saving path</span>
<span class="na">       multipart</span><span class="o">:</span>
<span class="na">         location</span><span class="o">:</span> <span class="s">/home/metatron/servers/metatron-integrator/upload_temp</span>
<span class="na">         max-file-size</span><span class="o">:</span> <span class="s">1000Mb</span>
<span class="na">         max-request-size</span><span class="o">:</span> <span class="s">1000Mb</span>
<span class="na">     activemq</span><span class="o">:</span>                           <span class="s"># JMS 수신을 위한 activemq 서버 정보</span>
<span class="na">       broker-url</span><span class="o">:</span> <span class="s">tcp://{activemq server IP}:61615</span>
<span class="na">       topic</span><span class="o">:</span> <span class="s">metatron</span>
<span class="na">       user</span><span class="o">:</span> <span class="s">metatron</span>
<span class="na">       password</span><span class="o">:</span>
<span class="na">     jms</span><span class="o">:</span>
<span class="na">       pub-sub-domain</span><span class="o">:</span> <span class="s">true</span>
<span class="na">     hadoop</span> <span class="o">:</span>                            <span class="s"># hadoop namenode 정보</span>
<span class="na">       url</span> <span class="o">:</span> <span class="s">http://hadoop-namenode</span>
<span class="na">       user.name</span> <span class="o">:</span> <span class="s">metatron</span>
<span class="na">       nameNodePort</span> <span class="o">:</span> <span class="s">50070</span>
<span class="na">       dataNodePort</span> <span class="o">:</span> <span class="s">50075</span>
<span class="na">       dataNodeUrlUsed</span> <span class="o">:</span> <span class="s">true</span>
<span class="na">       defaultPath</span> <span class="o">:</span> <span class="s">/webhdfs/v1</span>
<span class="na">       tunneling</span> <span class="o">:</span> <span class="s">false</span>
<span class="na">     oozie</span> <span class="o">:</span>                             <span class="s"># oozie server 정보</span>
<span class="na">       oozieUrl</span> <span class="o">:</span> <span class="s">http://{oozie server IP}                                       # oozie server ip ex) http://1.2.3.4</span>
<span class="na">       ooziePort</span> <span class="o">:</span> <span class="s">11000                                                         # oozie server port. default 11000</span>

<span class="na">       timezone.offset</span> <span class="o">:</span> <span class="s">T+0900</span>
<span class="na">       timezone.location</span> <span class="o">:</span> <span class="s">Asia/Seoul</span>

<span class="na">       hdfs.workflowSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/workflow              # workflow saving HDFS path</span>
<span class="na">       hdfs.coordinatorSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/coordinator        # coordinator saving path</span>
<span class="na">       hdfs.taskSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/task                      # task library temporary saving path</span>
<span class="na">       hdfs.defaultPath</span> <span class="o">:</span> <span class="s">/user/metatron                                         # base path</span>

<span class="na">       jobConf.nameNode</span> <span class="o">:</span> <span class="s">hdfs://{HDFS name service}                             # workflow namenode variable. ex) hdfs://metatron-cluster</span>
<span class="na">       jobConf.jobTracker</span> <span class="o">:</span> <span class="s">{Yarn resourcemanager address}                       # workflow job tracker(YARN) server variable ex) metatron-hadoop-01:8032</span>
<span class="na">       jobConf.oozie.use.system.libpath</span> <span class="o">:</span> <span class="s">true                                   # oozie.use.system.libpath variable</span>
<span class="na">       jobConf.oozie.libpath</span> <span class="o">:</span> <span class="s">/user/oozie/share/lib                             # oozie.libpath variable (HDFS Path)</span>
<span class="na">       jobConf.impersonate.mode</span> <span class="o">:</span> <span class="s">true                                           # Is user.name equals application runner</span>
<span class="na">       jobConf.impersonate.name</span> <span class="o">:</span> <span class="s">metatron                                       # user.name variable</span>
<span class="na">       jobConf.defaultQueue.name</span> <span class="o">:</span> <span class="s">default                                       # workflow queue name variables</span>

<span class="na">     druid</span><span class="o">:</span>                             <span class="s"># druid task 정보</span>
<span class="na">       userid</span><span class="o">:</span> <span class="s">admin                                                             # discovery oauth token 획득을 위한 admin 계정 id</span>
<span class="na">       password</span><span class="o">:</span> <span class="s">admin                                                                                                                   # discovery oauth token 획득을 위한 admin 계정 password</span>
<span class="na">       discoveryUrl</span><span class="o">:</span> <span class="s">http://{discovery server IP}:{discovery port}               # discovery oauth token 획득을 위한 discovery 서버 정보</span>
<span class="na">       authorization</span><span class="o">:</span> <span class="s">Basic cG9sYXJpc19jbGllbnQ6cG9sYXJpcw==                     # discovery oauth token 획득을 위한 request header 내 Authorization 값</span>
<span class="na">       jarPath</span><span class="o">:</span> <span class="s">/user/metatron/integrator/ext_scripts/metatron-integrator-druid.jar       # druid task(metatron-integrator-druid.jar)의 HDFS 상 경로</span>

<span class="na"> server</span><span class="o">:</span>
<span class="na">     port</span><span class="o">:</span> <span class="s">8280                    # integrator server listen port(service port)</span>
<span class="na">     compression</span><span class="o">:</span>
<span class="na">         enabled</span><span class="o">:</span> <span class="s">true</span>
<span class="na">         mime-types</span><span class="o">:</span> <span class="s">text/html,text/xml,text/plain,text/css, application/javascript, application/json</span>
<span class="na">         min-response-size</span><span class="o">:</span> <span class="s">1024</span>

<span class="na"> liquibase</span><span class="o">:</span>
<span class="na">     contexts</span><span class="o">:</span> <span class="s">prod</span>

<span class="na"> notification</span><span class="o">:</span>                         <span class="s"># JMS 를 통해 수신한 Job event , SLA event 를 전달하기 위한 messaging server 정보</span>
<span class="na">   slack</span><span class="o">:</span>                              <span class="s"># Slack 정보</span>
<span class="na">     webhookUrl</span><span class="o">:</span>                       <span class="s"># Setup &amp; Configure Incoming-Webhook URL in Slack &gt; Apps</span>
<span class="na">     botName</span><span class="o">:</span>                          <span class="s"># (Optional) if empty, use default value that configured in Slack App</span>
<span class="na">     botEmoji</span><span class="o">:</span>                         <span class="s"># (Optional) if empty, use default value that configured in Slack App</span>
<span class="na">     notiChannel</span><span class="o">:</span>                      <span class="s"># (Optional) if empty, use default value that configured in Slack App</span>
<span class="na">   sms</span><span class="o">:</span>                                <span class="s"># SMS 서버 정보</span>
<span class="na">     requestUrl</span><span class="o">:</span> <span class="s">&quot;http://{sms server IP}:{sms server port}/esc-channel/etc/sms/sendsmsinfo&quot;</span>
<span class="na">     senderNumber</span><span class="o">:</span> <span class="s">&quot;01000000000&quot;        # The message sender&#39;s number</span>
<span class="na">     receiverNumber</span><span class="o">:</span> <span class="s">&quot;010000000&quot;</span>

<span class="na"> security</span><span class="o">:</span>                            <span class="s"># discovery 통합 로그인을 위한 인증서버 정보(discovery 서버 정보)</span>
<span class="na">   basic</span><span class="o">:</span>
<span class="na">     enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">   oauth2</span><span class="o">:</span>
     <span class="c"># OAuth 서버 Client 정보</span>
<span class="na">     client</span><span class="o">:</span>
<span class="na">       client-id</span><span class="o">:</span> <span class="s">polaris_client</span>
<span class="na">       client-secret</span><span class="o">:</span> <span class="s">polaris</span>
<span class="na">     resource</span><span class="o">:</span>                        <span class="s"># oauth url</span>
<span class="na">       token-info-uri</span><span class="o">:</span> <span class="s">http://{metatron discovery server IP}:{metatron discovery server port}/oauth/check_token</span>

<span class="na"> logging</span><span class="o">:</span>
<span class="na">     level</span><span class="o">:</span>
<span class="na">         ROOT</span><span class="o">:</span> <span class="s">INFO</span>
<span class="na">         com.sample</span><span class="o">:</span> <span class="s">INFO</span>
<span class="na">         io.github.jhipster</span><span class="o">:</span> <span class="s">INFO</span>

<span class="na"> jhipster</span><span class="o">:</span>                   <span class="s"># jhipster 서버 정보(설정 불필요)</span>
<span class="na">     http</span><span class="o">:</span>
<span class="na">         version</span><span class="o">:</span> <span class="s">V_1_1 # To use HTTP/2 you will need SSL support (see above the &quot;server.ssl&quot; configuration)</span>
<span class="na">         cache</span><span class="o">:</span> <span class="s"># Used by the CachingHttpHeadersFilter</span>
<span class="na">             timeToLiveInDays</span><span class="o">:</span> <span class="s">1461</span>
<span class="na">     mail</span><span class="o">:</span> <span class="s"># specific JHipster mail property, for standard properties see MailProperties</span>
<span class="na">         from</span><span class="o">:</span> <span class="s">sample@localhost</span>
<span class="na">         base-url</span><span class="o">:</span> <span class="s">http://my-server-url-to-change # Modify according to your server&#39;s URL</span>
<span class="na">     metrics</span><span class="o">:</span> <span class="s"># DropWizard Metrics configuration, used by MetricsConfiguration</span>
<span class="na">         jmx.enabled</span><span class="o">:</span> <span class="s">true</span>
<span class="na">         graphite</span><span class="o">:</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             host</span><span class="o">:</span> <span class="s">localhost</span>
<span class="na">             port</span><span class="o">:</span> <span class="s">2003</span>
<span class="na">             prefix</span><span class="o">:</span> <span class="s">sample</span>
<span class="na">         prometheus</span><span class="o">:</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             endpoint</span><span class="o">:</span> <span class="s">/prometheusMetrics</span>
<span class="na">         logs</span><span class="o">:</span> <span class="s"># Reports Dropwizard metrics in the logs</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             report-frequency</span><span class="o">:</span> <span class="s">60 # in seconds</span>
<span class="na">     logging</span><span class="o">:</span>
<span class="na">         logstash</span><span class="o">:</span> <span class="s"># Forward logs to logstash over a socket, used by LoggingConfiguration</span>
<span class="na">             enabled</span><span class="o">:</span> <span class="s">false</span>
<span class="na">             host</span><span class="o">:</span> <span class="s">localhost</span>
<span class="na">             port</span><span class="o">:</span> <span class="s">5000</span>
<span class="na">             queue-size</span><span class="o">:</span> <span class="s">512</span>

<span class="na"> zuul</span><span class="o">:</span>                          <span class="s"># zuul 서버 정보</span>
<span class="na">   routes</span><span class="o">:</span>
<span class="na">     oauth</span><span class="o">:</span>
<span class="na">       path</span><span class="o">:</span> <span class="s">/oauth/**</span>
<span class="na">       url</span><span class="o">:</span> <span class="s">http://{metatron discovery server IP}:{metatron discovery server port}              # require metatron discovery server IP, port</span>
<span class="na">       sensitiveHeaders</span><span class="o">:</span> <span class="s">Cookie,Set-Cookie</span>
<span class="na">       stripPrefix</span><span class="o">:</span> <span class="s">false</span>
<span class="na">     stomp</span><span class="o">:</span>
<span class="na">       path</span><span class="o">:</span> <span class="s">/stomp/**</span>
<span class="na">       url</span><span class="o">:</span> <span class="s">http://{metatron discovery server IP}:{metatron discovery server port}              # require metatron discovery server IP, port</span>
<span class="na">       sensitiveHeaders</span><span class="o">:</span> <span class="s">Cookie,Set-Cookie</span>
<span class="na">       strip-prefix</span><span class="o">:</span> <span class="s">true</span>
<span class="na">     api</span><span class="o">:</span>
<span class="na">       path</span><span class="o">:</span> <span class="s">/api/**</span>
<span class="na">       url</span><span class="o">:</span> <span class="s">http://{metatron discovery server IP}:{metatron discovery server port}              # require metatron discovery server IP, port</span>
<span class="na">       sensitiveHeaders</span><span class="o">:</span> <span class="s">Cookie,Set-Cookie</span>
<span class="na">       stripPrefix</span><span class="o">:</span> <span class="s">false</span>

<span class="na"> application</span><span class="o">:</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>
<div class="section" id="make-application-directory-in-hdfs">
<h3>3-3. Make application directory in HDFS<a class="headerlink" href="#make-application-directory-in-hdfs" title="제목 주소">¶</a></h3>
<p>yaml 파일에서 아래와 같이 application 에서 사용하는 HDFS 상의 디렉토리를 정의하게 된다.</p>
<blockquote>
<div><div class="highlight-jproperties"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="na"> hdfs.workflowSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/workflow</span>
<span class="na"> hdfs.coordinatorSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/coordinator</span>
<span class="na"> hdfs.taskSavingPath</span> <span class="o">:</span> <span class="s">/user/metatron/integrator/task</span>
<span class="na"> hdfs.defaultPath</span> <span class="o">:</span> <span class="s">/user/metatron</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>yaml 파일에서 설정한 workflow, coordinator, task 경로에 맞춰 HDFS 내에&nbsp; directory 를 생성하여야 한다. 위에서 설정한 경로를 hadoop cluster 내에 hadoop fs -mkdir 명령어로 생성해 주면 된다.</p>
</div>
<div class="section" id="integrator-library-upload-to-hdfs">
<h3>3-4. integrator library upload to HDFS<a class="headerlink" href="#integrator-library-upload-to-hdfs" title="제목 주소">¶</a></h3>
<p>integrator 에서 사용하는 library 는 HDFS 에 업로드되어야 한다. ext_scripts 는 /user/metatron/integrator/ext_scripts 로 업로드한다.</p>
</div>
<div class="section" id="application-run-script-integrator-sh">
<h3>3-5. application run script(integrator.sh) 확인<a class="headerlink" href="#application-run-script-integrator-sh" title="제목 주소">¶</a></h3>
<p>application 실행 스크립트인 integrator.sh 파일내에 application.yaml 의 profile 을 설정하여야 한다. 일반적인 경우 prod 라는 profile 을 사용하지만 yaml 파일 내에 복수개의 profile 을 정의 하는 경우는 profile name 을 지정해 주어야 한다.</p>
<p>spring.profiles.active 항목에 application.yaml 에 설정한 profile 명을 넣어서 yaml 파일 profile 을 불러올 수 있도록 설정하여야 한다.</p>
<p>또한, application 의 설치 경로(/home/metatron/servers/metatron-integrator)를 변경하는 경우에도 shell script 내 base dir 정보를 변경해 주어야 한다.</p>
</div>
<div class="section" id="application-start">
<h3>3-6. application start<a class="headerlink" href="#application-start" title="제목 주소">¶</a></h3>
<p>integrator.sh start / stop 명령어를 통해서 application 을 실행하거나 종료할 수 있다.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Metatron Integrator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, SKT

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.4.2',
              LANGUAGE:'ko',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>